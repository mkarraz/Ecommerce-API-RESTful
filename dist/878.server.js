"use strict";exports.id=878,exports.ids=[878],exports.modules={878:(t,e,r)=>{r.r(e),r.d(e,{default:()=>c});var d=r(185),i=r.n(d);const o=new(i().Schema)({products:[{type:Object,required:!0,ref:"products"}],user:{type:String,required:!0},timestamp:{type:Number,required:!0,default:Date.now}}),n=i().model("carts",o);var s=r(826);var u=function(t,e,r,d){return new(r||(r=Promise))((function(i,o){function n(t){try{u(d.next(t))}catch(t){o(t)}}function s(t){try{u(d.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,s)}u((d=d.apply(t,e||[])).next())}))};const c=new class{constructor(t,e){this.model=t,this.DTO=e}createNewCart(t){return u(this,void 0,void 0,(function*(){const e=new this.model({user:{id:t.id,username:t.email},products:[]});yield e.save()}))}cartProdDeleteById(t){return u(this,void 0,void 0,(function*(){const e=yield this.model.findOne({user:t.id});if(null===e)return{error:"Cart not found in cartProdDeleteById method"};0===(yield this.model.updateOne({_id:e._id},{$set:{products:[]}})).modifiedCount?s.Z.error("Products not deleted from cart"):s.Z.info("Products deleted from cart")}))}addToCartById(t,e){return u(this,void 0,void 0,(function*(){const r=yield this.model.findOne({user:t._id});if(null===r)s.Z.error("Cart not found in addToCartById method.");else{if(0!==(yield this.model.updateOne({_id:r._id},{$push:{products:e}})).modifiedCount)return s.Z.info("Product succesfully added to cart!"),r;s.Z.error("Product not added to cart.")}}))}getProductsByCartId(t){return u(this,void 0,void 0,(function*(){const e=yield this.model.findOne({user:t.id});if(null===e)return{error:"Cart not found"};{const t=e.products;return s.Z.info(`Cart: ${t}`),t}}))}deleteProductByCartId(t,e){return u(this,void 0,void 0,(function*(){s.Z.info(`prod: ${e}`);const r=yield this.model.findOne({user:t.id});if(s.Z.info(`cart: ${r}`),null===r)return{error:"Cart not found"};0===(yield this.model.updateOne({_id:r._id},{$pull:{products:{id:e.id}}})).modifiedCount?s.Z.error("Product not deleted from cart"):s.Z.info("Product succesfully deleted from cart!")}))}}(n,class{constructor(t){this.id=t.id,this.products=t.products,this.user=t.user.id,this.timestamp=t.timestamp}getId(){return this.id}getProduct(){return this.products}getUserId(){return this.user.id}getUserName(){return this.user.username}getTimestamp(){return this.timestamp}toJson(){return{id:this.id,product:this.products,user:this.user.id,timestamp:this.timestamp}}})}};